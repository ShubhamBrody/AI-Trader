# --- Upstox (optional) ---
# Put real values in your local `.env` (this file is only an example).
# Keep SAFE_MODE=true while testing.
UPSTOX_CLIENT_ID=
UPSTOX_CLIENT_SECRET=
UPSTOX_ACCESS_TOKEN=

# If true, Upstox failures raise errors (no stub fallback)
UPSTOX_STRICT=false

# Usually you can keep defaults
UPSTOX_BASE_URL=https://api.upstox.com
UPSTOX_HFT_BASE_URL=https://api-hft.upstox.com

# Upstox resilience (optional)
UPSTOX_RETRY_MAX_ATTEMPTS=3
UPSTOX_RETRY_BACKOFF_SECONDS=0.5
UPSTOX_CB_FAILURES=5
UPSTOX_CB_COOLDOWN_SECONDS=20

# --- App ---
APP_ENV=dev
DATABASE_PATH=./data/app.db
LOG_LEVEL=INFO
LOG_JSON=false

# When set (e.g. "lightweight"), the AI engine will append this suffix to the
# computed model family when loading trained models (e.g. long -> long_lightweight).
# This lets you run trading/prediction using the lightweight models you trained.
MODEL_FAMILY_SUFFIX=

# --- Trading ---
SAFE_MODE=true
# Explicit real-money switch. Live orders require BOTH:
#   SAFE_MODE=false
#   LIVE_TRADING_ENABLED=true
LIVE_TRADING_ENABLED=false
TIMEZONE=Asia/Kolkata

# Autotrader: derive SL/Target from AI predictions (optional)
AUTOTRADER_AI_RISK_PLAN_ENABLED=false

# --- HFT: Index Options (safe-by-default) ---
INDEX_OPTIONS_HFT_ENABLED=false
INDEX_OPTIONS_HFT_AUTOSTART=false
INDEX_OPTIONS_HFT_BROKER=paper
INDEX_OPTIONS_HFT_POLL_SECONDS=5

# Optional AI gate for HFT entries (AIEngine must agree with direction)
INDEX_OPTIONS_HFT_AI_GATE_ENABLED=false
INDEX_OPTIONS_HFT_AI_MIN_CONFIDENCE=0.60
INDEX_OPTIONS_HFT_AI_INTERVAL=1m
INDEX_OPTIONS_HFT_AI_LOOKBACK_DAYS=7
INDEX_OPTIONS_HFT_AI_HORIZON_STEPS=12

# --- Crash recovery (optional) ---
# If enabled, the app will reconcile recent Upstox orders on startup.
# This helps recover missing broker order IDs after a crash/restart.
ORDER_RECOVERY_ON_STARTUP=false
ORDER_RECOVERY_LOOKBACK_HOURS=24
ORDER_RECOVERY_STARTUP_LIMIT=200

# --- Live reconciliation (optional) ---
# If enabled, periodically reconciles Upstox orders + positions and emits alerts
# (e.g. unknown open broker orders).
LIVE_RECONCILE_ENABLED=false
LIVE_RECONCILE_POLL_SECONDS=30

# --- Live failsafes (recommended for real money; active only when LIVE_RECONCILE_ENABLED=true) ---
# If broker has unknown open orders, freeze new orders and/or disable agent.
FAILSAFE_AUTOFREEZE_ON_UNKNOWN_BROKER_ORDERS=true
FAILSAFE_DISABLE_AGENT_ON_UNKNOWN_BROKER_ORDERS=true

# If daily loss is breached (broker truth pnl estimate), freeze and/or disable agent.
FAILSAFE_AUTOFREEZE_ON_DAILY_LOSS=true
FAILSAFE_DISABLE_AGENT_ON_DAILY_LOSS=true

# --- Notes ---
# For idempotent order placement, pass `client_order_id` in POST /api/orders/place.

# --- Optional API security ---
# If enabled, protected endpoints require header: X-API-Key: <API_KEY>
REQUIRE_API_KEY=false
API_KEY=

# Recommended: split keys (write for trading controls, read for dashboards).
# If unset, API_KEY is used as fallback.
API_KEY_WRITE=
API_KEY_READ=

# Admin key (recommended): required for /api/controls/emergency/* and agent start/stop/flatten.
# If unset, API_KEY_WRITE is used.
API_KEY_ADMIN=

# Optional allowlist for API writes (defense-in-depth). Comma-separated CIDRs.
# Example: 127.0.0.1/32,10.0.0.0/8
API_WRITE_ALLOWLIST_CIDRS=

# WebSockets are unauthenticated by default for local dev.
# If enabled, supply `X-API-Key` header OR `?api_key=...` on ws:// URLs.
REQUIRE_API_KEY_WEBSOCKETS=false

# --- Metrics (Prometheus) ---
METRICS_ENABLED=false

# --- News summaries (Ollama) ---
# If enabled, the backend will try to fetch each article URL and ask a local Ollama
# model for a short 1-2 sentence summary shown on the News cards.
NEWS_LLM_SUMMARY_ENABLED=false
NEWS_LLM_SUMMARY_TTL_DAYS=7
OLLAMA_BASE_URL=http://localhost:11434
OLLAMA_MODEL=llama3.2:latest

# Trend confluence (multi-timeframe) (OFF by default)
# Uses SMA(50/200) + MACD(12,26,9) cross + RSI(14) + ADX(14, +DI/-DI) + Volume EMA(10)
# across 1d/4h/1h to determine high-confidence trend direction.
TRADER_TREND_CONFLUENCE_ENABLED=false
# If enabled, /api/trader/decision will force HOLD when confluence is "range" or conflicts with BUY/SELL.
TRADER_TREND_CONFLUENCE_GATE_ENABLED=false
# Lookback windows (days) per timeframe.
TRADER_TREND_CONFLUENCE_DAILY_DAYS=420
TRADER_TREND_CONFLUENCE_H4_DAYS=90
TRADER_TREND_CONFLUENCE_H1_DAYS=30

# Autotrader: let AI decide when to gate/scale using confluence (OFF by default)
AUTOTRADER_TREND_CONFLUENCE_ENABLED=false

# HFT index options: let AI decide when to gate/scale using confluence (OFF by default)
INDEX_OPTIONS_HFT_TREND_CONFLUENCE_ENABLED=false

# --- Optional rate limiting ---
RATE_LIMIT_ENABLED=false
RATE_LIMIT_PER_MINUTE=120

# --- Alert delivery (optional) ---
# Telegram (recommended for critical alerts)
ALERT_TELEGRAM_ENABLED=false
ALERT_TELEGRAM_BOT_TOKEN=
ALERT_TELEGRAM_CHAT_ID=
ALERT_TELEGRAM_COOLDOWN_SECONDS=60
